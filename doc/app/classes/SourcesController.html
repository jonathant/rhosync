<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: SourcesController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">SourcesController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/sources_controller_rb.html">
                app/controllers/sources_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000009">attributes</a>&nbsp;&nbsp;
      <a href="#M000023">create</a>&nbsp;&nbsp;
      <a href="#M000010">createobjects</a>&nbsp;&nbsp;
      <a href="#M000012">deleteobjects</a>&nbsp;&nbsp;
      <a href="#M000025">destroy</a>&nbsp;&nbsp;
      <a href="#M000022">edit</a>&nbsp;&nbsp;
      <a href="#M000013">editobject</a>&nbsp;&nbsp;
      <a href="#M000020">index</a>&nbsp;&nbsp;
      <a href="#M000016">load_all</a>&nbsp;&nbsp;
      <a href="#M000021">new</a>&nbsp;&nbsp;
      <a href="#M000014">newobject</a>&nbsp;&nbsp;
      <a href="#M000015">pick_load</a>&nbsp;&nbsp;
      <a href="#M000017">pick_save</a>&nbsp;&nbsp;
      <a href="#M000019">refresh</a>&nbsp;&nbsp;
      <a href="#M000018">save_all</a>&nbsp;&nbsp;
      <a href="#M000008">show</a>&nbsp;&nbsp;
      <a href="#M000024">update</a>&nbsp;&nbsp;
      <a href="#M000011">updateobjects</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="SourcesHelper.html">SourcesHelper</a></span>
      </div>
    </div>

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">attributes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
return the metadata for the specified source
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 33</span>
33:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">attributes</span>
34:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
35:     <span class="ruby-comment cmt"># get the distinct list of attributes that is available</span>
36:     <span class="ruby-ivar">@attributes</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">find_by_sql</span> <span class="ruby-value str">&quot;select distinct(attrib) from object_values where source_id=&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
37: 
38:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
39:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
40:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@attributes</span>}
41:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@attributes</span>}
42:     <span class="ruby-keyword kw">end</span>
43:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000023" class="method-detail">
        <a name="M000023"></a>

        <div class="method-heading">
          <a href="#M000023" class="method-signature">
          <span class="method-name">create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
POST /sources POST /sources.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000023-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000023-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 341</span>
341:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>
342:     <span class="ruby-ivar">@source</span> = <span class="ruby-constant">Source</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:source</span>])
343: 
344:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
345:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">save</span>
346:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">'Source was successfully created.'</span>
347:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-ivar">@source</span>) }
348:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:created</span>, <span class="ruby-identifier">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span> }
349:       <span class="ruby-keyword kw">else</span>
350:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new&quot;</span> }
351:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">errors</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:unprocessable_entity</span> }
352:       <span class="ruby-keyword kw">end</span>
353:     <span class="ruby-keyword kw">end</span>
354:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">createobjects</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
this creates all of the rows in the object values table corresponding to
the array of hashes given by the attrvals parameter note that the REFRESH
action below will later DELETE all of the created records
</p>
<p>
also note YOU MUST CREATE A TEMPORARY OBJECT ID. Some form of hash or CRC
</p>
<pre>
 of all of the values can be used
</pre>
<p>
for example :attrvals=
</p>
<pre>
  [{&quot;object&quot;=&gt;&quot;temp1&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;rhomobile&quot;},
  {&quot;object&quot;=&gt;&quot;temp1&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;},
  {&quot;object&quot;=&gt;&quot;temp1&quot;,&quot;attrib&quot;=&gt;&quot;employees&quot;,&quot;value&quot;=&gt;&quot;500&quot;}
  {&quot;object&quot;=&gt;&quot;temp2&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;mobio&quot;},
  {&quot;object&quot;=&gt;&quot;temp2&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;},
  {&quot;object&quot;=&gt;&quot;temp3&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;xaware&quot;},
  {&quot;object&quot;=&gt;&quot;temp3&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;}]
</pre>
<p>
RETURNS:
</p>
<pre>
  a hash of the object_values table ID columns as keys and the updated_at times as values
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 65</span>
65:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">createobjects</span>
66:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
67:     <span class="ruby-identifier">objects</span>={}
68:     <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:attrvals</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-comment cmt"># for each hash in the array</span>
69:        <span class="ruby-comment cmt"># note that there should NOT be an object value for new records</span>
70:        <span class="ruby-identifier">o</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">new</span>
71:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">object</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;object&quot;</span>]
72:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">attrib</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;attrib&quot;</span>]
73:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">value</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;value&quot;</span>]
74:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">update_type</span>=<span class="ruby-value str">&quot;create&quot;</span>
75:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">source</span>=<span class="ruby-ivar">@source</span>
76:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">save</span>
77:        <span class="ruby-comment cmt"># add the created ID + created_at time to the list</span>
78:        <span class="ruby-identifier">objects</span>[<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>]=<span class="ruby-identifier">o</span>.<span class="ruby-identifier">created_at</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>)  <span class="ruby-comment cmt"># add to list of objects</span>
79:     <span class="ruby-keyword kw">end</span>
80: 
81:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
82:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { 
83:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;Created objects&quot;</span>
84:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;show&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">id</span>
85:       }
86:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
87:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
88:     <span class="ruby-keyword kw">end</span>
89:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">deleteobjects</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
this creates all of the rows in the object values table corresponding to
the hash given by attrvals. note that the REFRESH action below will later
DELETE all of the created records
</p>
<p>
RETURNS:
</p>
<pre>
  a hash of the object_values table ID columns as keys and the updated_at times as values
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 137</span>
137:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">deleteobjects</span>
138:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
139:     <span class="ruby-identifier">objects</span>={}
140:     <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:attrvals</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
141:        <span class="ruby-identifier">o</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">new</span>
142:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">object</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;object&quot;</span>]
143:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">attrib</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;attrib&quot;</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;attrib&quot;</span>]
144:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">value</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;value&quot;</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;value&quot;</span>]
145:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">update_type</span>=<span class="ruby-value str">&quot;delete&quot;</span>
146:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">source</span>=<span class="ruby-ivar">@source</span>
147:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">save</span>
148:        <span class="ruby-comment cmt"># add the created ID + created_at time to the list</span>
149:        <span class="ruby-identifier">objects</span>[<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>]=<span class="ruby-identifier">o</span>.<span class="ruby-identifier">created_at</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>)  <span class="ruby-comment cmt"># add to list of objects</span>
150:     <span class="ruby-keyword kw">end</span>
151: 
152:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
153:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-keyword kw">do</span>
154:             <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;Deleted objects&quot;</span>
155:             <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;show&quot;</span>
156:       <span class="ruby-keyword kw">end</span>
157:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
158:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
159:     <span class="ruby-keyword kw">end</span>
160:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000025" class="method-detail">
        <a name="M000025"></a>

        <div class="method-heading">
          <a href="#M000025" class="method-signature">
          <span class="method-name">destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
DELETE /sources/1 DELETE /sources/1.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000025-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000025-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 386</span>
386:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy</span>
387:     <span class="ruby-ivar">@source</span> = <span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
388:     <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">destroy</span>
389: 
390:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
391:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">sources_url</span>) }
392:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-identifier">:ok</span> }
393:     <span class="ruby-keyword kw">end</span>
394:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000022" class="method-detail">
        <a name="M000022"></a>

        <div class="method-heading">
          <a href="#M000022" class="method-signature">
          <span class="method-name">edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /sources/1/edit
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000022-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000022-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 334</span>
334:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit</span>
335:     <span class="ruby-ivar">@source</span> = <span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
336:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit&quot;</span>
337:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">editobject</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 162</span>
162:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">editobject</span>
163:     <span class="ruby-comment cmt"># bring up an editing form for</span>
164:     <span class="ruby-ivar">@object</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">find_by_source_id_and_object_and_attrib</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:object</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:attrib</span>]
165:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">index</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /sources GET /sources.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 312</span>
312:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>
313:     <span class="ruby-ivar">@sources</span> = <span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>)
314: 
315:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
316:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># index.html.erb</span>
317:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sources</span> }
318:     <span class="ruby-keyword kw">end</span>
319:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">load_all</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 176</span>
176:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_all</span>
177:     <span class="ruby-comment cmt"># NOTE: THIS DOES NOT WORK FROM OUR SAVING FORMAT RIGHT NOW! (the one that save_all does)</span>
178:     <span class="ruby-comment cmt"># it only works from the YAML format in db/migrate/sources.yml</span>
179:     <span class="ruby-comment cmt"># this is a very well reported upon Ruby/YAML issue</span>
180:     <span class="ruby-ivar">@sources</span>=<span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load_file</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yaml_file</span>]
181:     <span class="ruby-identifier">p</span> <span class="ruby-ivar">@sources</span>
182:     <span class="ruby-ivar">@sources</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
183:       <span class="ruby-identifier">source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@sources</span>[<span class="ruby-identifier">x</span>])
184:       <span class="ruby-identifier">source</span>.<span class="ruby-identifier">save</span>
185:     <span class="ruby-keyword kw">end</span>
186:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;Loaded sources&quot;</span>
187:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;index&quot;</span>
188:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000021" class="method-detail">
        <a name="M000021"></a>

        <div class="method-heading">
          <a href="#M000021" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /sources/new GET /sources/new.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000021-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000021-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 324</span>
324:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>
325:     <span class="ruby-ivar">@source</span> = <span class="ruby-constant">Source</span>.<span class="ruby-identifier">new</span>
326: 
327:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
328:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># new.html.erb</span>
329:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span> }
330:     <span class="ruby-keyword kw">end</span>
331:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">newobject</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 167</span>
167:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">newobject</span>
168:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
169:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">pick_load</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 172</span>
172:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pick_load</span>
173:     <span class="ruby-comment cmt"># go to the view to pick the file to load</span>
174:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">pick_save</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 190</span>
190:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pick_save</span>
191:     <span class="ruby-comment cmt"># go to the view to pick the file</span>
192:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">refresh</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
this connects to the web service of the given source backend and:
</p>
<ul>
<li>does a prolog (generally logging in)

</li>
<li>does creating, updating, deleting of records as required

</li>
<li>reads (queries) records from the backend

</li>
<li>does an epilog (logs off)

</li>
</ul>
<p>
it should be invoked on a scheduled basis by some admin process, generally
using CURL. it should also be done with a separate instance than the one
used to service <a href="SourcesController.html#M000023">create</a>, <a
href="SourcesController.html#M000024">update</a> and delete calls from the client
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 216</span>
216:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">refresh</span>
217:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
218:     <span class="ruby-comment cmt"># not all endpoints require WSDL!</span>
219:     <span class="ruby-identifier">client</span> = <span class="ruby-constant">SOAP</span><span class="ruby-operator">::</span><span class="ruby-constant">WSDLDriverFactory</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">url</span>).<span class="ruby-identifier">create_rpc_driver</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">url</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">url</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
220:     <span class="ruby-comment cmt"># make sure to use client and session_id variables</span>
221:     <span class="ruby-comment cmt"># in your code that is edited into each source!</span>
222:     <span class="ruby-identifier">callbinding</span>=<span class="ruby-identifier">eval</span> <span class="ruby-node">%&quot;#{@source.prolog};binding&quot;</span>
223: 
224:     <span class="ruby-comment cmt"># first do all the the creates</span>
225:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">createcall</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">createcall</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
226:       <span class="ruby-identifier">creates</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-value str">&quot;select * from object_values where update_type='create'&quot;</span>)
227:       <span class="ruby-identifier">uniqobjs</span>=<span class="ruby-identifier">creates</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">object</span>}
228:       <span class="ruby-identifier">uniqobjs</span>.<span class="ruby-identifier">uniq!</span>
229:       <span class="ruby-identifier">uniqobjs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
230:         <span class="ruby-identifier">p</span> <span class="ruby-value str">&quot;Searching for attribute values for object: &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">x</span>
231:         <span class="ruby-identifier">xvals</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">find_all_by_object_and_update_type</span>(<span class="ruby-identifier">x</span>,<span class="ruby-value str">'create'</span>)  <span class="ruby-comment cmt"># this has all the attribute value pairs for this particular object</span>
232:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">xvals</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
233:           <span class="ruby-identifier">attrvalues</span>={}
234:           <span class="ruby-identifier">xvals</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">y</span><span class="ruby-operator">|</span>
235:             <span class="ruby-identifier">p</span> <span class="ruby-value str">&quot;Attribute: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">y</span>.<span class="ruby-identifier">attrib</span>
236:             <span class="ruby-identifier">p</span> <span class="ruby-value str">&quot;Value: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">y</span>.<span class="ruby-identifier">value</span>
237:             <span class="ruby-identifier">attrvalues</span>[<span class="ruby-identifier">y</span>.<span class="ruby-identifier">attrib</span>]=<span class="ruby-identifier">y</span>.<span class="ruby-identifier">value</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">y</span>.<span class="ruby-identifier">attrib</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">y</span>.<span class="ruby-identifier">value</span>
238:             <span class="ruby-identifier">y</span>.<span class="ruby-identifier">destroy</span>
239:           <span class="ruby-keyword kw">end</span>
240:           <span class="ruby-comment cmt"># now attrvalues has the attribute values needed for the createcall</span>
241:           <span class="ruby-comment cmt"># the Sugar adapter will use the name_value_list variable that we're building up here</span>
242:           <span class="ruby-comment cmt"># TODO: name_value_list is probably too specific to Sugar</span>
243:           <span class="ruby-comment cmt">#  need a clean way to pass the attrvalues hash to any source adapter cleanly</span>
244:           <span class="ruby-identifier">p</span> <span class="ruby-value str">&quot;Attributes hash size: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">attrvalues</span>.<span class="ruby-identifier">size</span>.<span class="ruby-identifier">to_s</span>
245:           <span class="ruby-identifier">nvlist</span>=<span class="ruby-identifier">make_name_value_list</span>(<span class="ruby-identifier">attrvalues</span>)
246:           <span class="ruby-identifier">callbinding</span>=<span class="ruby-identifier">eval</span>(<span class="ruby-value str">&quot;name_value_list=&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">nvlist</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;;&quot;</span><span class="ruby-operator">+</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">createcall</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;;binding&quot;</span>,<span class="ruby-identifier">callbinding</span>)
247:         <span class="ruby-keyword kw">end</span>
248: 
249:       <span class="ruby-keyword kw">end</span>
250:     <span class="ruby-keyword kw">end</span>
251: 
252:     <span class="ruby-comment cmt"># now do the updates</span>
253:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">updatecall</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">updatecall</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
254:       <span class="ruby-identifier">updates</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-value str">&quot;select * from object_values where update_type='update'&quot;</span>)
255:       <span class="ruby-identifier">uniqobjs</span>=<span class="ruby-identifier">updates</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span><span class="ruby-identifier">x</span>.<span class="ruby-identifier">object</span>}
256:       <span class="ruby-identifier">uniqobjs</span>.<span class="ruby-identifier">uniq!</span>
257:       <span class="ruby-identifier">uniqobjs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
258:         <span class="ruby-identifier">objvals</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">find_all_by_object_and_update_type</span>(<span class="ruby-identifier">x</span>,<span class="ruby-value str">'update'</span>)  <span class="ruby-comment cmt"># this has all the attribute value pairs now</span>
259:         <span class="ruby-identifier">attrvalues</span>={}
260:         <span class="ruby-identifier">attrvalues</span>[<span class="ruby-value str">&quot;id&quot;</span>]=<span class="ruby-identifier">x</span>  <span class="ruby-comment cmt"># setting the ID allows it be an update</span>
261:         <span class="ruby-identifier">objvals</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">y</span><span class="ruby-operator">|</span>
262:           <span class="ruby-identifier">attrvalues</span>[<span class="ruby-identifier">y</span>.<span class="ruby-identifier">attrib</span>]=<span class="ruby-identifier">y</span>.<span class="ruby-identifier">value</span>
263:           <span class="ruby-identifier">y</span>.<span class="ruby-identifier">destroy</span>
264:         <span class="ruby-keyword kw">end</span>
265:         <span class="ruby-comment cmt"># now attrvalues has the attribute values needed for the createcall</span>
266:         <span class="ruby-identifier">nvlist</span>=<span class="ruby-identifier">make_name_value_list</span>(<span class="ruby-identifier">attrvalues</span>)
267:         <span class="ruby-identifier">callbinding</span>=<span class="ruby-identifier">eval</span>(<span class="ruby-value str">&quot;name_value_list=&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">nvlist</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;;&quot;</span><span class="ruby-operator">+</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">updatecall</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;;binding&quot;</span>,<span class="ruby-identifier">callbinding</span>)
268:       <span class="ruby-keyword kw">end</span>
269:     <span class="ruby-keyword kw">end</span>
270: 
271:     <span class="ruby-comment cmt"># now do the deletes</span>
272:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">deletecall</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">deletecall</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
273:       <span class="ruby-identifier">deletes</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-value str">&quot;select * from object_values where update_type='delete'&quot;</span>)
274:       <span class="ruby-identifier">uniqobjs</span>=<span class="ruby-identifier">deletes</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span><span class="ruby-identifier">x</span>.<span class="ruby-identifier">object</span>}
275:       <span class="ruby-identifier">uniqobjs</span>.<span class="ruby-identifier">uniq!</span>
276:       <span class="ruby-identifier">uniqobjs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
277:         <span class="ruby-identifier">attrvalues</span>={}
278:         <span class="ruby-identifier">attrvalues</span>[<span class="ruby-value str">&quot;id&quot;</span>]=<span class="ruby-identifier">x</span>
279:         <span class="ruby-identifier">nvlist</span>=<span class="ruby-identifier">make_name_value_list</span>(<span class="ruby-identifier">attrvalues</span>)
280:         <span class="ruby-identifier">callbinding</span>=<span class="ruby-identifier">eval</span>(<span class="ruby-value str">&quot;name_value_list=&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">nvlist</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;;&quot;</span><span class="ruby-operator">+</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">deletecall</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;;binding&quot;</span>,<span class="ruby-identifier">callbinding</span>)
281:       <span class="ruby-keyword kw">end</span>
282:       <span class="ruby-identifier">deletes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>  <span class="ruby-comment cmt"># get rid of the deletes</span>
283:         <span class="ruby-identifier">x</span>.<span class="ruby-identifier">destroy</span>
284:       <span class="ruby-keyword kw">end</span>
285:     <span class="ruby-keyword kw">end</span>
286: 
287:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">call</span>
288:       <span class="ruby-comment cmt"># now do the query call</span>
289:       <span class="ruby-identifier">p</span> <span class="ruby-value str">&quot;Executing query call&quot;</span>
290:       <span class="ruby-identifier">callbinding</span>=<span class="ruby-identifier">eval</span>(<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">call</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;;binding&quot;</span>,<span class="ruby-identifier">callbinding</span>)
291:       <span class="ruby-comment cmt"># delete the old source records</span>
292:       <span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">delete_all</span> <span class="ruby-value str">&quot;update_type='query' and source_id=&quot;</span><span class="ruby-operator">+</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
293:       <span class="ruby-comment cmt"># now take apart the returned data and fill the object values table</span>
294:       <span class="ruby-identifier">p</span> <span class="ruby-value str">&quot;Executing backend data sync&quot;</span>
295:       <span class="ruby-identifier">callbinding</span>=<span class="ruby-identifier">eval</span>(<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">sync</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;;binding&quot;</span>,<span class="ruby-identifier">callbinding</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">sync</span>
296:     <span class="ruby-keyword kw">end</span>
297: 
298:     <span class="ruby-comment cmt"># now do the logoff</span>
299:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">epilog</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">epilog</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
300:       <span class="ruby-identifier">callbinding</span>=<span class="ruby-identifier">eval</span>(<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">epilog</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;;binding&quot;</span>,<span class="ruby-identifier">callbinding</span>)
301:     <span class="ruby-keyword kw">end</span>
302: 
303:     <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">refreshtime</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">new</span>  <span class="ruby-comment cmt"># keep track of the refresh time to help optimize show queries</span>
304:     <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">save</span>
305: 
306:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;show&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">id</span>
307:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">save_all</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 194</span>
194:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save_all</span>
195:     <span class="ruby-ivar">@sources</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">:all</span>
196:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yaml_file</span>],<span class="ruby-value str">'w'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out</span><span class="ruby-operator">|</span>
197:       <span class="ruby-ivar">@sources</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
198:         <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">out</span>)
199:       <span class="ruby-keyword kw">end</span>
200:     <span class="ruby-keyword kw">end</span>
201:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;Saved sources&quot;</span>
202:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;index&quot;</span>
203:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">show</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 15</span>
15:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show</span>
16:     <span class="ruby-identifier">last_update_time</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:last_update</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:last_update</span>]
17:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
18:     <span class="ruby-comment cmt"># if we have a last_update parameter then only do the update</span>
19:     <span class="ruby-comment cmt"># if the last update time is before the most recent refresh then bring back values</span>
20:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">last_update_time</span> <span class="ruby-keyword kw">or</span> (<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">refreshtime</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">last_update_time</span><span class="ruby-operator">&lt;=&gt;</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">refreshtime</span>)<span class="ruby-operator">&lt;</span><span class="ruby-value">0</span>)
21:       <span class="ruby-ivar">@object_values</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">find_all_by_update_type_and_source_id</span> <span class="ruby-value str">&quot;query&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
22:     <span class="ruby-keyword kw">else</span>  <span class="ruby-comment cmt"># no need to bring back values because we're still waiting for a refresh on the server!</span>
23:       <span class="ruby-ivar">@object_values</span>=<span class="ruby-keyword kw">nil</span>
24:     <span class="ruby-keyword kw">end</span>
25:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
26:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
27:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@object_values</span>}
28:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@object_values</span>}
29:     <span class="ruby-keyword kw">end</span>
30:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000024" class="method-detail">
        <a name="M000024"></a>

        <div class="method-heading">
          <a href="#M000024" class="method-signature">
          <span class="method-name">update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
PUT /sources/1 PUT /sources/1.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000024-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000024-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 358</span>
358:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
359:     <span class="ruby-ivar">@source</span> = <span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
360: 
361:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
362:       <span class="ruby-keyword kw">begin</span>
363:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:source</span>])
364:           <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">save_to_yaml</span>
365:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">'Source was successfully updated.'</span>
366:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-ivar">@source</span>) }
367:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-identifier">:ok</span> }
368:         <span class="ruby-keyword kw">else</span>
369:           <span class="ruby-keyword kw">begin</span>  <span class="ruby-comment cmt"># call underlying save! so we can get some exceptions back to report</span>
370:             <span class="ruby-comment cmt"># (update_attributes just calls save</span>
371:             <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">save!</span>
372:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span>
373:             <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-identifier">$!</span>
374:           <span class="ruby-keyword kw">end</span>
375: 
376:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit&quot;</span> }
377:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">errors</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:unprocessable_entity</span> }
378:         <span class="ruby-keyword kw">end</span>
379:       <span class="ruby-keyword kw">end</span>
380:     <span class="ruby-keyword kw">end</span>
381: 
382:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">updateobjects</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
this creates all of the rows in the object values table corresponding to
the array of hashes given by the attrval parameter. note that the REFRESH
action below will later DELETE all of the created records
</p>
<pre>
 # for example
</pre>
<p>
:attrvals=
</p>
<pre>
  [{&quot;object&quot;=&gt;&quot;1&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;rhomobile&quot;},
  {&quot;object&quot;=&gt;&quot;1&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;},
  {&quot;object&quot;=&gt;&quot;1&quot;,&quot;attrib&quot;=&gt;&quot;employees&quot;,&quot;value
  {&quot;object&quot;=&gt;&quot;2&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;mobio&quot;},
  {&quot;object&quot;=&gt;&quot;2&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;},
  {&quot;object&quot;=&gt;&quot;3&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;xaware&quot;},
  {&quot;object&quot;=&gt;&quot;3&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;}]
</pre>
<p>
RETURNS:
</p>
<pre>
  a hash of the object_values table ID columns as keys and the updated_at times as values
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 106</span>
106:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">updateobjects</span>
107:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
108:     <span class="ruby-identifier">objects</span>={}
109:     <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:attrvals</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>  <span class="ruby-comment cmt"># for each hash in the array</span>
110:        <span class="ruby-identifier">o</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">new</span>
111:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">object</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;object&quot;</span>]
112:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">attrib</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;attrib&quot;</span>]
113:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">value</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;value&quot;</span>]
114:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">update_type</span>=<span class="ruby-value str">&quot;update&quot;</span>
115:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">source</span>=<span class="ruby-ivar">@source</span>
116:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">save</span>
117:        <span class="ruby-comment cmt"># add the created ID + created_at time to the list</span>
118:        <span class="ruby-identifier">objects</span>[<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>]=<span class="ruby-identifier">o</span>.<span class="ruby-identifier">created_at</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>)  <span class="ruby-comment cmt"># add to list of objects</span>
119:     <span class="ruby-keyword kw">end</span>
120: 
121:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
122:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { 
123:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;Updated objects&quot;</span>
124:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;show&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">id</span>
125:       }
126:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
127:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
128:     <span class="ruby-keyword kw">end</span>
129:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>