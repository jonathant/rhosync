<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: SourcesController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">SourcesController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/sources_controller_rb.html">
                app/controllers/sources_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000029">ask</a>&nbsp;&nbsp;
      <a href="#M000006">callback</a>&nbsp;&nbsp;
      <a href="#M000030">check_version</a>&nbsp;&nbsp;
      <a href="#M000012">clientcreate</a>&nbsp;&nbsp;
      <a href="#M000013">clientregister</a>&nbsp;&nbsp;
      <a href="#M000014">clientreset</a>&nbsp;&nbsp;
      <a href="#M000023">create</a>&nbsp;&nbsp;
      <a href="#M000015">createobjects</a>&nbsp;&nbsp;
      <a href="#M000017">deleteobjects</a>&nbsp;&nbsp;
      <a href="#M000025">destroy</a>&nbsp;&nbsp;
      <a href="#M000022">edit</a>&nbsp;&nbsp;
      <a href="#M000010">edit_search</a>&nbsp;&nbsp;
      <a href="#M000018">editobject</a>&nbsp;&nbsp;
      <a href="#M000033">find_source</a>&nbsp;&nbsp;
      <a href="#M000032">get_new_token</a>&nbsp;&nbsp;
      <a href="#M000035">get_wrapped_list</a>&nbsp;&nbsp;
      <a href="#M000031">handle_show_format</a>&nbsp;&nbsp;
      <a href="#M000020">index</a>&nbsp;&nbsp;
      <a href="#M000021">new</a>&nbsp;&nbsp;
      <a href="#M000019">newobject</a>&nbsp;&nbsp;
      <a href="#M000026">noaccess</a>&nbsp;&nbsp;
      <a href="#M000034">nvlist_to_hash</a>&nbsp;&nbsp;
      <a href="#M000007">ping</a>&nbsp;&nbsp;
      <a href="#M000008">ping_user</a>&nbsp;&nbsp;
      <a href="#M000011">search</a>&nbsp;&nbsp;
      <a href="#M000009">show</a>&nbsp;&nbsp;
      <a href="#M000027">test_createobjects</a>&nbsp;&nbsp;
      <a href="#M000024">update</a>&nbsp;&nbsp;
      <a href="#M000016">updateobjects</a>&nbsp;&nbsp;
      <a href="#M000028">viewlog</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="SourcesHelper.html">SourcesHelper</a></span>
      </div>
    </div>

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">UNSUPPORTED_VERSIONS</td>
          <td>=</td>
          <td class="context-item-value">[1]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SUPPORTED_VERSIONS</td>
          <td>=</td>
          <td class="context-item-value">[2]</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000029" class="method-detail">
        <a name="M000029"></a>

        <div class="method-heading">
          <a href="#M000029" class="method-signature">
          <span class="method-name">ask</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
quick synchronous simple query that doesn&#8216;t hit the database
parameters:
</p>
<pre>
  question
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000029-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000029-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 457</span>
457:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ask</span>
458:     <span class="ruby-ivar">@app</span>=<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>
459:     <span class="ruby-ivar">@token</span>=<span class="ruby-identifier">get_new_token</span>
460:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:question</span>]
461:       <span class="ruby-ivar">@object_values</span>=<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">ask</span>(<span class="ruby-ivar">@current_user</span>,<span class="ruby-identifier">params</span>)
462:       <span class="ruby-ivar">@object_values</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">&lt;</span><span class="ruby-value">1</span> }  <span class="ruby-comment cmt"># don't send back blank or nil OAV triples</span>
463:     <span class="ruby-keyword kw">else</span>
464:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;You need to provide a question to answer&quot;</span>
465:     <span class="ruby-keyword kw">end</span>
466: 
467:     <span class="ruby-ivar">@object_values</span>.<span class="ruby-identifier">collect!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
468:        <span class="ruby-identifier">x</span>.<span class="ruby-identifier">id</span> = <span class="ruby-identifier">x</span>.<span class="ruby-identifier">hash_from_data</span>(<span class="ruby-identifier">x</span>.<span class="ruby-identifier">attrib</span>,<span class="ruby-identifier">x</span>.<span class="ruby-identifier">object</span>,<span class="ruby-identifier">x</span>.<span class="ruby-identifier">update_type</span>,<span class="ruby-identifier">x</span>.<span class="ruby-identifier">source_id</span>,<span class="ruby-identifier">x</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-identifier">x</span>.<span class="ruby-identifier">value</span>)
469:        <span class="ruby-identifier">x</span>.<span class="ruby-identifier">db_operation</span> = <span class="ruby-value str">'insert'</span>
470:        <span class="ruby-identifier">x</span>.<span class="ruby-identifier">update_type</span> = <span class="ruby-value str">'query'</span>
471:        <span class="ruby-identifier">x</span>
472:     }
473:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
474:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;show&quot;</span>}
475:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;show&quot;</span>}
476:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;show&quot;</span>}
477:     <span class="ruby-keyword kw">end</span>
478:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">callback</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 23</span>
23:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">callback</span>
24:     <span class="ruby-identifier">current_user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_login</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:login</span>]
25:     <span class="ruby-ivar">@app</span>=<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>
26:     <span class="ruby-constant">Bj</span>.<span class="ruby-identifier">submit</span> <span class="ruby-node">&quot;ruby script/runner ./jobs/sync_and_ping_user.rb #{current_user.id} #{params[:id]} #{app_source_url(:app_id=&gt;@app.name, :id =&gt; @source.name)}&quot;</span>,
27:        <span class="ruby-identifier">:tag</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
28:     <span class="ruby-identifier">render</span>(<span class="ruby-identifier">:nothing=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:status=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">200</span>)
29:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">clientcreate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
generate a <a href="SourcesController.html#M000021">new</a> client for this
source
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 125</span>
125:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clientcreate</span>
126:     <span class="ruby-ivar">@client</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>
127:     <span class="ruby-ivar">@client</span>.<span class="ruby-identifier">user</span> = <span class="ruby-identifier">current_user</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_user</span>
128: 
129:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
130:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@client</span>.<span class="ruby-identifier">save</span>
131:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@client</span> }
132:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-identifier">:ok</span> }
133:       <span class="ruby-keyword kw">end</span>
134:     <span class="ruby-keyword kw">end</span>
135:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">clientregister</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
register client for for push notifications
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 138</span>
138:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clientregister</span>
139:     <span class="ruby-identifier">find_and_register_client</span>
140:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:nothing</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">200</span>
141:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">clientreset</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
reset client_maps data
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 144</span>
144:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clientreset</span>
145:     <span class="ruby-ivar">@client</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">find_by_client_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:client_id</span>])
146:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@client</span>
147:       <span class="ruby-ivar">@client</span>.<span class="ruby-identifier">reset</span>
148:     <span class="ruby-keyword kw">end</span>
149:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:nothing=</span><span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">200</span>
150:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000023" class="method-detail">
        <a name="M000023"></a>

        <div class="method-heading">
          <a href="#M000023" class="method-signature">
          <span class="method-name">create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
POST /apps/:app_id/sources POST /apps/:app_id/sources.xml
</p>
<p>
Example xml request body: &lt;source&gt;
</p>
<pre>
  &lt;name&gt;product&lt;/name&gt;
  &lt;adapter&gt;product&lt;/adapter&gt;
</pre>
<p>
&lt;/source&gt;
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000023-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000023-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 371</span>
371:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>
372:     <span class="ruby-ivar">@source</span> = <span class="ruby-constant">Source</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:source</span>])
373:     <span class="ruby-identifier">error</span>=<span class="ruby-keyword kw">nil</span>
374:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Source</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">name</span>)
375:       <span class="ruby-identifier">error</span>=<span class="ruby-value str">&quot;Source already exists. Please try a different name.&quot;</span>
376:     <span class="ruby-keyword kw">end</span>
377:     <span class="ruby-ivar">@app</span>=<span class="ruby-constant">App</span>.<span class="ruby-identifier">find_by_permalink</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:source</span>][<span class="ruby-identifier">:app_id</span>])
378:     <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>=<span class="ruby-ivar">@app</span>
379:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
380:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">error</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">save</span>
381:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">'Source was successfully created.'</span>
382:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;apps&quot;</span>,<span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">:edit</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@app</span>.<span class="ruby-identifier">id</span>) }
383:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:created</span>, <span class="ruby-identifier">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span> }
384:       <span class="ruby-keyword kw">else</span>
385:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-identifier">error</span>
386:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new&quot;</span> }
387:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">errors</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:unprocessable_entity</span> }
388:       <span class="ruby-keyword kw">end</span>
389:     <span class="ruby-keyword kw">end</span>
390:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">createobjects</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
this creates all of the rows in the object values table corresponding to
the array of hashes given by the attrvals parameter note that the REFRESH
action below will later DELETE all of the created records
</p>
<p>
also note YOU MUST CREATE A TEMPORARY OBJECT ID. Some form of hash or CRC
</p>
<pre>
 of all of the values can be used
</pre>
<p>
for example :attrvals=
</p>
<pre>
  [{&quot;object&quot;=&gt;&quot;temp1&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;rhomobile&quot;},
  {&quot;object&quot;=&gt;&quot;temp1&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;},
  {&quot;object&quot;=&gt;&quot;temp1&quot;,&quot;attrib&quot;=&gt;&quot;employees&quot;,&quot;value&quot;=&gt;&quot;500&quot;}
  {&quot;object&quot;=&gt;&quot;temp2&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;mobio&quot;},
  {&quot;object&quot;=&gt;&quot;temp2&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;},
  {&quot;object&quot;=&gt;&quot;temp3&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;xaware&quot;},
  {&quot;object&quot;=&gt;&quot;temp3&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;}]
</pre>
<p>
RETURNS:
</p>
<pre>
  a hash of the object_values table ID columns as keys and the updated_at times as values
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 171</span>
171:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">createobjects</span>
172:     <span class="ruby-ivar">@app</span>=<span class="ruby-constant">App</span>.<span class="ruby-identifier">find_by_permalink</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:app_id</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:app_id</span>]
173:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find_by_permalink</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
174:     <span class="ruby-identifier">check_access</span>(<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>)
175:     <span class="ruby-identifier">objects</span>={}
176:     <span class="ruby-ivar">@client</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">find_by_client_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:client_id</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:client_id</span>]
177: 
178:     <span class="ruby-identifier">newqparms</span>=<span class="ruby-value">1</span> <span class="ruby-comment cmt"># flag that tells us that the first time we have an object named qparms we need to change query parameters</span>
179:     <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:attrvals</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-comment cmt"># for each hash in the array</span>
180:       <span class="ruby-comment cmt"># note that there should NOT be an object value for new records</span>
181:       <span class="ruby-identifier">o</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">new</span>
182:       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">object</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;object&quot;</span>]
183:       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">attrib</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;attrib&quot;</span>]
184:       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">value</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;value&quot;</span>]
185:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;object&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-value str">&quot;qparms&quot;</span>
186:         <span class="ruby-identifier">cleanup_update_type</span>(<span class="ruby-value str">&quot;qparms&quot;</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)  <span class="ruby-comment cmt"># delete the existing qparms objects</span>
187:         <span class="ruby-identifier">newqparms</span>=<span class="ruby-keyword kw">nil</span>  <span class="ruby-comment cmt"># subsequent qparms objects just add to the qparms objectvalue triples</span>
188:         <span class="ruby-identifier">o</span>.<span class="ruby-identifier">update_type</span>=<span class="ruby-value str">&quot;qparms&quot;</span>
189:       <span class="ruby-keyword kw">else</span>
190:         <span class="ruby-identifier">o</span>.<span class="ruby-identifier">update_type</span>=<span class="ruby-value str">&quot;create&quot;</span>
191:       <span class="ruby-keyword kw">end</span>
192:       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">source</span>=<span class="ruby-ivar">@source</span>
193:       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">user_id</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>
194: 
195:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;attrib_type&quot;</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;attrib_type&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'blob'</span>
196:         <span class="ruby-identifier">o</span>.<span class="ruby-identifier">blob</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:blob</span>]
197:         <span class="ruby-identifier">o</span>.<span class="ruby-identifier">blob</span>.<span class="ruby-identifier">instance_write</span>(<span class="ruby-identifier">:file_name</span>, <span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;value&quot;</span>])
198:       <span class="ruby-keyword kw">end</span>
199:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@client</span>.<span class="ruby-identifier">client_temp_objects</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">:temp_objectid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">x</span>[<span class="ruby-value str">'object'</span>])
200:         <span class="ruby-ivar">@client</span>.<span class="ruby-identifier">client_temp_objects</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:temp_objectid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">x</span>[<span class="ruby-value str">'object'</span>], <span class="ruby-identifier">:source_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">id</span>) 
201:       <span class="ruby-keyword kw">end</span>
202:       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">save</span>
203:       <span class="ruby-comment cmt"># add the created ID + created_at time to the list</span>
204:       <span class="ruby-identifier">objects</span>[<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>]=<span class="ruby-identifier">o</span>.<span class="ruby-identifier">created_at</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>)  <span class="ruby-comment cmt"># add to list of objects</span>
205:     <span class="ruby-keyword kw">end</span>
206:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
207:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:no_redirect</span>]
208:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {
209:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;Created objects&quot;</span>
210:           <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;show&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">id</span>,<span class="ruby-identifier">:app_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>.<span class="ruby-identifier">id</span>
211:         }
212:       <span class="ruby-keyword kw">else</span>
213:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {
214:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;Created objects&quot;</span>
215:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;show&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">id</span>,<span class="ruby-identifier">:app_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>.<span class="ruby-identifier">id</span>
216:         }
217:       <span class="ruby-keyword kw">end</span>
218:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
219:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
220:     <span class="ruby-keyword kw">end</span>
221:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SourceAdapterLoginException</span>
222:    <span class="ruby-identifier">logout_killing_session!</span>
223:    <span class="ruby-identifier">render</span> <span class="ruby-identifier">:nothing=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">401</span>
224:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">deleteobjects</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
this creates all of the rows in the object values table corresponding to
the hash given by attrvals. note that the REFRESH action below will later
DELETE all of the created records
</p>
<p>
RETURNS:
</p>
<pre>
  a hash of the object_values table ID columns as keys and the updated_at times as values
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 276</span>
276:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">deleteobjects</span>
277:     <span class="ruby-identifier">check_access</span>(<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>)
278:     <span class="ruby-identifier">objects</span>={}
279:     <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:attrvals</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
280:        <span class="ruby-identifier">o</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">new</span>
281:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">object</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;object&quot;</span>]
282:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">attrib</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;attrib&quot;</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;attrib&quot;</span>]
283:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">value</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;value&quot;</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;value&quot;</span>]
284:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">update_type</span>=<span class="ruby-value str">&quot;delete&quot;</span>
285:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">source</span>=<span class="ruby-ivar">@source</span>
286:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">user_id</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>
287:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">save</span>
288:        <span class="ruby-comment cmt"># add the created ID + created_at time to the list</span>
289:        <span class="ruby-identifier">objects</span>[<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>]=<span class="ruby-identifier">o</span>.<span class="ruby-identifier">created_at</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>)  <span class="ruby-comment cmt"># add to list of objects</span>
290:     <span class="ruby-keyword kw">end</span>
291: 
292:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
293:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-keyword kw">do</span>
294:             <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;Deleted objects&quot;</span>
295:             <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;show&quot;</span>
296:       <span class="ruby-keyword kw">end</span>
297:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
298:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
299:     <span class="ruby-keyword kw">end</span>
300: 
301:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SourceAdapterLoginException</span>
302:     <span class="ruby-identifier">logout_killing_session!</span>
303:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:nothing=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">401</span>
304:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000025" class="method-detail">
        <a name="M000025"></a>

        <div class="method-heading">
          <a href="#M000025" class="method-signature">
          <span class="method-name">destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
DELETE /sources/1 DELETE /sources/1.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000025-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000025-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 431</span>
431:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy</span>
432:     <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">destroy</span>
433:     <span class="ruby-ivar">@app</span>=<span class="ruby-constant">App</span>.<span class="ruby-identifier">find_by_permalink</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:app_id</span>]
434:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">'Source was successfully deleted.'</span>
435:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
436:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;apps&quot;</span>,<span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@app</span>.<span class="ruby-identifier">id</span> }
437:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-identifier">:ok</span> }
438:     <span class="ruby-keyword kw">end</span>
439:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000022" class="method-detail">
        <a name="M000022"></a>

        <div class="method-heading">
          <a href="#M000022" class="method-signature">
          <span class="method-name">edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /sources/1/edit
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000022-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000022-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 351</span>
351:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit</span>
352:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
353:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">:sessions</span>,<span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">:new</span>
354:     <span class="ruby-keyword kw">else</span>
355:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-value str">&quot;Current user: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">login</span>
356:     <span class="ruby-keyword kw">end</span>
357:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find_by_permalink</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
358:     <span class="ruby-ivar">@app</span>=<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>
359:     <span class="ruby-ivar">@apps</span>=<span class="ruby-constant">Administration</span>.<span class="ruby-identifier">find_all_by_user_id</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)
360:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit&quot;</span>
361:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">edit_search</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 88</span>
88:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_search</span>
89:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find_by_permalink</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
90:     <span class="ruby-ivar">@app</span>=<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>
91:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">editobject</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 306</span>
306:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">editobject</span>
307:     <span class="ruby-comment cmt"># bring up an editing form for</span>
308:     <span class="ruby-ivar">@object</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">find_by_source_id_and_object_and_attrib</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">id</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:object</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:attrib</span>]
309:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">index</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /sources GET /sources.xml this returns all sources that are associated
with a given &quot;app&quot; as determine by the token
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 317</span>
317:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>
318:     <span class="ruby-identifier">login</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">login</span>
319:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:app_id</span>].<span class="ruby-identifier">nil?</span>
320:       <span class="ruby-ivar">@app</span>=<span class="ruby-constant">App</span>.<span class="ruby-identifier">find_by_admin</span> <span class="ruby-identifier">login</span>
321:     <span class="ruby-keyword kw">else</span>
322:       <span class="ruby-ivar">@app</span>=<span class="ruby-constant">App</span>.<span class="ruby-identifier">find_by_permalink</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:app_id</span>]
323:     <span class="ruby-keyword kw">end</span>
324:     <span class="ruby-ivar">@sources</span>=<span class="ruby-ivar">@app</span>.<span class="ruby-identifier">sources</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@app</span>
325: 
326:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
327:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># index.html.erb</span>
328:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sources</span> }
329:     <span class="ruby-keyword kw">end</span>
330:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000021" class="method-detail">
        <a name="M000021"></a>

        <div class="method-heading">
          <a href="#M000021" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /sources/new GET /sources/new.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000021-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000021-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 334</span>
334:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>
335:     <span class="ruby-ivar">@source</span> = <span class="ruby-constant">Source</span>.<span class="ruby-identifier">new</span>
336: 
337:     <span class="ruby-ivar">@app</span>=<span class="ruby-constant">App</span>.<span class="ruby-identifier">find_by_permalink</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:app_id</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:app_id</span>]
338:     <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>=<span class="ruby-ivar">@app</span>
339:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@app</span>.<span class="ruby-identifier">sources</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-comment cmt"># default the url,login and password</span>
340:       <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">url</span>=<span class="ruby-ivar">@app</span>.<span class="ruby-identifier">sources</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">url</span>
341:       <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">login</span>=<span class="ruby-ivar">@app</span>.<span class="ruby-identifier">sources</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">login</span>
342:       <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">password</span>=<span class="ruby-ivar">@app</span>.<span class="ruby-identifier">sources</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">password</span>
343:     <span class="ruby-keyword kw">end</span>
344:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
345:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># new.html.erb</span>
346:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span> }
347:     <span class="ruby-keyword kw">end</span>
348:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">newobject</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 311</span>
311:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">newobject</span>
312:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000026" class="method-detail">
        <a name="M000026"></a>

        <div class="method-heading">
          <a href="#M000026" class="method-signature">
          <span class="method-name">noaccess</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000026-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000026-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 441</span>
441:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">noaccess</span>
442:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">ping</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
PUSH TO ALL QUEUED UP USERS: (see <a
href="SourcesController.html#M000009">show</a> method below for queueing
mechanism this notifies all users and their devices that have
&quot;registered&quot; interest in an queued sync completion or backend
</p>
<pre>
 via a PAP push (BlackBerry BES, iPhone APN push, or SMS (Windows Mobile)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 35</span>
35:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ping</span>
36:     <span class="ruby-identifier">lastslash</span>=<span class="ruby-identifier">request</span>.<span class="ruby-identifier">url</span>.<span class="ruby-identifier">rindex</span>(<span class="ruby-value str">'/'</span>)
37:     <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">callback_url</span>=<span class="ruby-identifier">request</span>.<span class="ruby-identifier">url</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">lastslash</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lastslash</span>
38:     <span class="ruby-ivar">@result</span>=<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">ping</span>
39:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">ping_user</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
PUSH TO SPECIFIC USER: this pings JUST the specified user with the given
message defaults to no message, 1/2 second vibrate also provides <a
href="SourcesController.html#M000006">callback</a> URL of this
source&#8216;s <a href="SourcesController.html#M000009">show</a> method but
allows for overriding this <a
href="SourcesController.html#M000006">callback</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 45</span>
45:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ping_user</span>
46:     <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Pinging user #{params[:login]}&quot;</span>
47:     <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_login</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:login</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:login</span>]
48:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
49:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Failed to find user to notify: #{params[:login]}&quot;</span>
50:     <span class="ruby-keyword kw">else</span>
51:       <span class="ruby-identifier">callback_url</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:callback_url</span>]
52:       <span class="ruby-identifier">lastslash</span>=<span class="ruby-identifier">request</span>.<span class="ruby-identifier">url</span>.<span class="ruby-identifier">rindex</span>(<span class="ruby-value str">'/'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">callback_url</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-comment cmt"># compute the callback if not supplied</span>
53:       <span class="ruby-identifier">callback_url</span>=<span class="ruby-identifier">request</span>.<span class="ruby-identifier">url</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">lastslash</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lastslash</span>  <span class="ruby-comment cmt"># as the show method on this controller</span>
54:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">callback_url</span>
55:         <span class="ruby-ivar">@result</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">ping</span>(<span class="ruby-identifier">callback_url</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:message</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:vibrate</span>])  <span class="ruby-comment cmt"># only does the notify if we have a message and a callback</span>
56:       <span class="ruby-keyword kw">end</span>
57:     <span class="ruby-keyword kw">end</span>
58:     <span class="ruby-ivar">@result</span>
59:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">search</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
queries for specific data from backend parameters:
</p>
<pre>
 order- hash of values to be sent to the backend adapter to effect a query
 offset - optional argument of how far into the query we are, NONZERO VALUE MEANS USE CURRENT CACHE
 limit - optional number of rows to return
 conditions - hash of name-values for query
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 99</span>
 99:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">search</span>
100:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find_by_permalink</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
101:     <span class="ruby-ivar">@app</span>=<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>
102:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">check_access</span>(<span class="ruby-ivar">@app</span>)
103:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;noaccess&quot;</span>
104:     <span class="ruby-keyword kw">else</span>
105:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_user</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">usersub</span>=<span class="ruby-ivar">@app</span>.<span class="ruby-identifier">memberships</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span>)
106:         <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">credential</span>=<span class="ruby-identifier">usersub</span>.<span class="ruby-identifier">credential</span>  <span class="ruby-comment cmt"># this variable is available in your source adapter</span>
107:       <span class="ruby-keyword kw">end</span>
108:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:conditions</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
109:         <span class="ruby-identifier">conditions</span>=<span class="ruby-identifier">nvlist_to_hash</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:conditions</span>])
110:       <span class="ruby-keyword kw">else</span>
111:         <span class="ruby-identifier">conditions</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:conditions</span>]
112:       <span class="ruby-keyword kw">end</span>
113: 
114:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Searching for #{conditions.inspect.to_s}&quot;</span>
115: 
116:       <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">dosearch</span>(<span class="ruby-ivar">@current_user</span>,<span class="ruby-identifier">session</span>,<span class="ruby-identifier">conditions</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:max_results</span>].<span class="ruby-identifier">to_i</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:offset</span>].<span class="ruby-identifier">to_i</span>)
117:       <span class="ruby-identifier">build_object_values</span>(<span class="ruby-value str">'query'</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:client_id</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:ack_token</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_size</span>],<span class="ruby-identifier">conditions</span>,<span class="ruby-keyword kw">false</span>)
118:       <span class="ruby-identifier">get_wrapped_list</span>(<span class="ruby-ivar">@object_values</span>)
119:       <span class="ruby-ivar">@count</span> = <span class="ruby-ivar">@count</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-ivar">@object_values</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@count</span>
120:       <span class="ruby-identifier">handle_show_format</span>
121:     <span class="ruby-keyword kw">end</span>
122:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">show</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
shows ALL data from backend, refreshing data when necessary (if data is
empty or &quot;stale&quot;) use <a
href="SourcesController.html#M000011">search</a> method if you wish to
request specific data IF you wish to have device pinged when by <a
href="SourcesController.html#M000007">ping</a> method for important events
THEN supply params[&quot;device_pin&quot;] and
params[&quot;device_type&quot;]
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 65</span>
65:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show</span>
66:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;id&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;rho_credential&quot;</span>
67:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;[]&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
68:     <span class="ruby-keyword kw">end</span>
69:     <span class="ruby-ivar">@app</span>=<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>
70:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">check_access</span>(<span class="ruby-ivar">@app</span>)
71:       <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wants</span><span class="ruby-operator">|</span>
72:         <span class="ruby-identifier">wants</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;noaccess&quot;</span> }
73:         <span class="ruby-identifier">wants</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;No Access&quot;</span> } }
74:       <span class="ruby-keyword kw">end</span>
75:     <span class="ruby-keyword kw">else</span>
76:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_user</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">usersub</span>=<span class="ruby-ivar">@app</span>.<span class="ruby-identifier">memberships</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span>)
77:         <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">credential</span>=<span class="ruby-identifier">usersub</span>.<span class="ruby-identifier">credential</span>  <span class="ruby-comment cmt"># this variable is available in your source adapter</span>
78:       <span class="ruby-keyword kw">end</span>
79:       <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">refresh</span>(<span class="ruby-ivar">@current_user</span>,<span class="ruby-identifier">session</span>, <span class="ruby-identifier">app_source_url</span>(<span class="ruby-identifier">:app_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@app</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">name</span>)) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:refresh</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">needs_refresh</span>
80:       <span class="ruby-identifier">build_object_values</span>(<span class="ruby-value str">'query'</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:client_id</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:ack_token</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_size</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:conditions</span>],<span class="ruby-keyword kw">true</span>)
81:       <span class="ruby-identifier">get_wrapped_list</span>(<span class="ruby-ivar">@object_values</span>)
82:       <span class="ruby-ivar">@count</span> = <span class="ruby-ivar">@count</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-ivar">@object_values</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@count</span>
83:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;wrapped_list: #{@wrapped_list.inspect}&quot;</span>
84:       <span class="ruby-identifier">handle_show_format</span>
85:     <span class="ruby-keyword kw">end</span>
86:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000027" class="method-detail">
        <a name="M000027"></a>

        <div class="method-heading">
          <a href="#M000027" class="method-signature">
          <span class="method-name">test_createobjects</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000027-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000027-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 444</span>
444:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_createobjects</span>
445:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
446:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
447:     <span class="ruby-keyword kw">end</span>
448:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000024" class="method-detail">
        <a name="M000024"></a>

        <div class="method-heading">
          <a href="#M000024" class="method-signature">
          <span class="method-name">update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
PUT /sources/1 PUT /sources/1.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000024-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000024-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 394</span>
394:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
395:     <span class="ruby-ivar">@app</span>=<span class="ruby-constant">App</span>.<span class="ruby-identifier">find_by_permalink</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;source&quot;</span>][<span class="ruby-value str">&quot;app_id&quot;</span>]
396:     <span class="ruby-identifier">error</span>=<span class="ruby-keyword kw">nil</span>
397:     <span class="ruby-identifier">src</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find_by_name</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;source&quot;</span>][<span class="ruby-value str">&quot;name&quot;</span>]
398:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">src!</span>=<span class="ruby-ivar">@source</span>
399:       <span class="ruby-identifier">error</span>=<span class="ruby-value str">&quot;Source name already exists. Please try a different name.&quot;</span>
400:     <span class="ruby-keyword kw">else</span>
401:       <span class="ruby-ivar">@app</span>=<span class="ruby-constant">App</span>.<span class="ruby-identifier">find_by_permalink</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;source&quot;</span>][<span class="ruby-value str">&quot;app_id&quot;</span>]
402:       <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>=<span class="ruby-ivar">@app</span>
403:     <span class="ruby-keyword kw">end</span>
404:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
405:       <span class="ruby-keyword kw">begin</span>
406:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">error</span> <span class="ruby-keyword kw">and</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:source</span>])
407:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">'Source was successfully updated.'</span>
408:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;apps&quot;</span>,<span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">:edit</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@app</span>.<span class="ruby-identifier">id</span>) }
409:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-identifier">:ok</span> }
410:         <span class="ruby-keyword kw">else</span>
411:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">error</span>
412:             <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-identifier">error</span>
413:           <span class="ruby-keyword kw">else</span>
414:             <span class="ruby-keyword kw">begin</span>  <span class="ruby-comment cmt"># call underlying save! so we can get some exceptions back to report</span>
415:               <span class="ruby-comment cmt"># (update_attributes just calls save</span>
416:               <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">save!</span>
417:             <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span>
418:               <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-identifier">$!</span>
419:             <span class="ruby-keyword kw">end</span>
420:           <span class="ruby-keyword kw">end</span>
421:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@app</span>.<span class="ruby-identifier">id</span> }
422:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">errors</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:unprocessable_entity</span> }
423:         <span class="ruby-keyword kw">end</span>
424:       <span class="ruby-keyword kw">end</span>
425:     <span class="ruby-keyword kw">end</span>
426: 
427:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">updateobjects</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
this creates all of the rows in the object values table corresponding to
the array of hashes given by the attrval parameter. note that the REFRESH
action below will later DELETE all of the created records
</p>
<pre>
 # for example
</pre>
<p>
:attrvals=
</p>
<pre>
  [{&quot;object&quot;=&gt;&quot;1&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;rhomobile&quot;},
  {&quot;object&quot;=&gt;&quot;1&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;},
  {&quot;object&quot;=&gt;&quot;1&quot;,&quot;attrib&quot;=&gt;&quot;employees&quot;,&quot;value
  {&quot;object&quot;=&gt;&quot;2&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;mobio&quot;},
  {&quot;object&quot;=&gt;&quot;2&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;},
  {&quot;object&quot;=&gt;&quot;3&quot;,&quot;attrib&quot;=&gt;&quot;name&quot;,&quot;value&quot;=&gt;&quot;xaware&quot;},
  {&quot;object&quot;=&gt;&quot;3&quot;,&quot;attrib&quot;=&gt;&quot;industry&quot;,&quot;value&quot;=&gt;&quot;software&quot;}]
</pre>
<p>
RETURNS:
</p>
<pre>
  a hash of the object_values table ID columns as keys and the updated_at times as values
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 241</span>
241:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">updateobjects</span>
242:     <span class="ruby-identifier">check_access</span>(<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>)
243:     <span class="ruby-identifier">objects</span>={}
244:     <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:attrvals</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>  <span class="ruby-comment cmt"># for each hash in the array</span>
245:        <span class="ruby-identifier">o</span>=<span class="ruby-constant">ObjectValue</span>.<span class="ruby-identifier">new</span>
246:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">object</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;object&quot;</span>]
247:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">attrib</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;attrib&quot;</span>]
248:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">value</span>=<span class="ruby-identifier">x</span>[<span class="ruby-value str">&quot;value&quot;</span>]
249:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">update_type</span>=<span class="ruby-value str">&quot;update&quot;</span>
250:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">user_id</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>
251:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">source</span>=<span class="ruby-ivar">@source</span>
252:        <span class="ruby-identifier">o</span>.<span class="ruby-identifier">save</span>
253:        <span class="ruby-comment cmt"># add the created ID + created_at time to the list</span>
254:        <span class="ruby-identifier">objects</span>[<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>]=<span class="ruby-identifier">o</span>.<span class="ruby-identifier">created_at</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">o</span>.<span class="ruby-identifier">id</span>)  <span class="ruby-comment cmt"># add to list of objects</span>
255:     <span class="ruby-keyword kw">end</span>
256: 
257:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
258:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {
259:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;Updated objects&quot;</span>
260:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;show&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">id</span>,<span class="ruby-identifier">:app_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">app</span>.<span class="ruby-identifier">id</span>
261:       }
262:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
263:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">objects</span> }
264:     <span class="ruby-keyword kw">end</span>
265:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SourceAdapterLoginException</span>
266:     <span class="ruby-identifier">logout_killing_session!</span>
267:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:nothing=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">401</span>
268:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000028" class="method-detail">
        <a name="M000028"></a>

        <div class="method-heading">
          <a href="#M000028" class="method-signature">
          <span class="method-name">viewlog</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000028-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000028-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 450</span>
450:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">viewlog</span>
451:     <span class="ruby-ivar">@logs</span>=<span class="ruby-constant">SourceLog</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">:source_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@source</span>.<span class="ruby-identifier">id</span>},<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;updated_at desc&quot;</span>
452:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000030" class="method-detail">
        <a name="M000030"></a>

        <div class="method-heading">
          <a href="#M000030" class="method-signature">
          <span class="method-name">check_version</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000030-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000030-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 482</span>
482:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_version</span>
483:     <span class="ruby-ivar">@version</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:version</span>]
484:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@version</span>
485:       <span class="ruby-ivar">@version</span> = <span class="ruby-ivar">@version</span>.<span class="ruby-identifier">to_i</span>
486:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">UNSUPPORTED_VERSIONS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@version</span>)
487:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;This server only supports the following protocol version(s): #{SUPPORTED_VERSIONS.join(',')}.  Please update your rhodes client.&quot;</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">404</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
488:       <span class="ruby-keyword kw">end</span>
489:     <span class="ruby-keyword kw">end</span>
490:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000033" class="method-detail">
        <a name="M000033"></a>

        <div class="method-heading">
          <a href="#M000033" class="method-signature">
          <span class="method-name">find_source</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000033-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000033-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 508</span>
508:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_source</span>
509:     <span class="ruby-ivar">@source</span>=<span class="ruby-constant">Source</span>.<span class="ruby-identifier">find_by_permalink</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
510:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000032" class="method-detail">
        <a name="M000032"></a>

        <div class="method-heading">
          <a href="#M000032" class="method-signature">
          <span class="method-name">get_new_token</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000032-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000032-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 504</span>
504:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_new_token</span>
505:     ((<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">mktime</span>(<span class="ruby-value">2009</span>,<span class="ruby-value str">&quot;jan&quot;</span>,<span class="ruby-value">1</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>).<span class="ruby-identifier">to_f</span>) <span class="ruby-operator">*</span> <span class="ruby-value">10</span><span class="ruby-operator">**</span><span class="ruby-value">6</span>).<span class="ruby-identifier">to_i</span>
506:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000035" class="method-detail">
        <a name="M000035"></a>

        <div class="method-heading">
          <a href="#M000035" class="method-signature">
          <span class="method-name">get_wrapped_list</span><span class="method-args">(ovlist)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000035-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000035-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 518</span>
518:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_wrapped_list</span>(<span class="ruby-identifier">ovlist</span>)
519:     <span class="ruby-ivar">@wrapped_list</span> = <span class="ruby-identifier">wrap_object_values</span>(<span class="ruby-identifier">ovlist</span>,<span class="ruby-ivar">@token</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@version</span>
520:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000031" class="method-detail">
        <a name="M000031"></a>

        <div class="method-heading">
          <a href="#M000031" class="method-signature">
          <span class="method-name">handle_show_format</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000031-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000031-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 492</span>
492:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_show_format</span>
493:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
494:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
495:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@object_values</span> }
496:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@version</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@version</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
497:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:template</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;sources/show.json_v2.erb&quot;</span> }
498:       <span class="ruby-keyword kw">else</span>
499:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span>
500:       <span class="ruby-keyword kw">end</span>
501:     <span class="ruby-keyword kw">end</span>
502:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000034" class="method-detail">
        <a name="M000034"></a>

        <div class="method-heading">
          <a href="#M000034" class="method-signature">
          <span class="method-name">nvlist_to_hash</span><span class="method-args">(nvlist)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000034-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000034-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sources_controller.rb, line 512</span>
512:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">nvlist_to_hash</span>(<span class="ruby-identifier">nvlist</span>)
513:     <span class="ruby-identifier">attrvals</span>={}
514:     <span class="ruby-identifier">nvlist</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">nv</span><span class="ruby-operator">|</span> <span class="ruby-identifier">attrvals</span>[<span class="ruby-identifier">nv</span>[<span class="ruby-value str">&quot;name&quot;</span>]]=<span class="ruby-identifier">nv</span>[<span class="ruby-value str">&quot;value&quot;</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nv</span>[<span class="ruby-value str">&quot;name&quot;</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">nv</span>[<span class="ruby-value str">&quot;value&quot;</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">nv</span>[<span class="ruby-value str">&quot;name&quot;</span>].<span class="ruby-identifier">size</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>}
515:     <span class="ruby-identifier">attrvals</span>
516:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>